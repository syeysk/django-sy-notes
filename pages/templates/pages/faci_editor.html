{% extends 'template.html' %}

{% block title %}
    {% if form_aim.instance.id %} <a style="text-decoration: none;" href="{% url 'faci_list' %}">ü°Ñ</a> –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ö–æ–ª—Å—Ç–∞ {% else %} –ù–æ–≤—ã–π —Ö–æ–ª—Å—Ç {% endif %}
{% endblock %}
{% block page_title %} –•–æ–ª—Å—Ç —Ñ–∞—Å–∏–ª–∏—Ç–∞—Ü–∏–∏ {% endblock %}

{% block content %}
    <style>
        .card-body form {
            position: relative;
        }
        .form_sheet {
            position: absolute;
            top: 0;
            left: 0;
            background-color: ghostwhite;
            opacity: 90%;
            width: 100%;
            height: 100%;
        }
    </style>

    <div class="row">
        <div class="col-sm-6">
            <div class="card">
                <div class="card-header">
                    1. –¶–µ–ª—å
                </div>
                <div class="card-body">
                    <form id="aim_form">
                        <div class="mb-3">
                            <label for="{{ form_aim.aim_type.id_for_label }}" class="form-label">{{ form_aim.aim_type.label }}</label>
                            {{ form_aim.aim_type }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form_aim.aim.id_for_label }}" class="form-label">{{ form_aim.aim.label }}</label>
                            {{ form_aim.aim }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form_aim.if_not_reached.id_for_label }}" class="form-label">{{ form_aim.if_not_reached.label }}</label>
                            {{ form_aim.if_not_reached }}
                        </div>
                   </form>
                </div>
            </div>
            
            <br>

            <div class="card">
                <div class="card-header">
                    2. –£—á–∞—Å—Ç–Ω–∏–∫–∏
                </div>
                <div class="card-body">
                    <form id="members_form">
                        <input type="button" value="–î–æ–±–∞–≤–∏—Ç—å">
                        <div class="{% if step > 1 %}d-none {% endif %}form_sheet">–î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –≤—ã–ø–æ–ª–Ω–∏—Ç–µ 1-–π —à–∞–≥</div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-sm-3">
            <div class="card">
                <div class="card-header">
                    3. –ü–æ–≤–µ—Å—Ç–∫–∞
                </div>
                <div class="card-body">
                    <form id="agenda_form">
                        <div class="{% if step > 2 %}d-none {% endif %}form_sheet">–î–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∑–∞–ø–æ–ª–Ω–∏—Ç–µ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, —Å–ø–∏—Å–æ–∫ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ (2-–π —à–∞–≥)</div>
                    </form>
                </div>
            </div>
        </div>
        
        <div class="col-sm-3">
            <div class="card">
                <div class="card-header">
                    4. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
                </div>
                <div class="card-body">
                    <form id="preparing_form">
                        <div class="mb-3">
                            <label for="{{ form_aim.dt_meeting.id_for_label }}" class="form-label">{{ form_aim.dt_meeting.label }}</label>
                            {{ form_aim.dt_meeting }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form_aim.duration.id_for_label }}" class="form-label">{{ form_aim.duration.label }}</label>
                            {{ form_aim.duration }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form_aim.place.id_for_label }}" class="form-label">{{ form_aim.place.label }}</label>
                            {{ form_aim.place }}
                        </div>
                        <div class="{% if step > 3 %}d-none {% endif %}form_sheet">–û—Ç–∫—Ä–æ–µ—Ç—Å—è –ø–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è 3-–≥–æ —à–∞–≥–∞</div>
                    </form>

                </div>
            </div>
        </div>
    </div>

    <br>

    <div class="row">
        <div class="col-sm-8">
            <div class="card">
                <div class="card-header">
                    5. –ö–ª—é—á–µ–≤—ã–µ –º—ã—Å–ª–∏
                </div>
                <div class="card-body">
                    <form id="key_thoughts_form">
                        <div class="mb-3">
                            <label for="{{ form_aim.key_thoughts.id_for_label }}" class="form-label">{{ form_aim.key_thoughts.label }}</label>
                            {{ form_aim.key_thoughts }}
                        </div>
                        <div class="mb-3">
                            <label for="{{ form_aim.parked_thoughts.id_for_label }}" class="form-label">{{ form_aim.parked_thoughts.label }}</label>
                            {{ form_aim.parked_thoughts }}
                        </div>
                        <div class="{% if step > 4 %}d-none {% endif %}form_sheet">–°—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤–æ –≤—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏ (–ø–æ—Å–ª–µ —à–∞–≥–∞ 4)</div>
                    </form>
                </div>
            </div>
        </div>

        <div class="col-sm-4">
            <div class="card">
                <div class="card-header">
                    6. –î–æ–≥–æ–≤–æ—Ä—ë–Ω–Ω–æ—Å—Ç–∏
                </div>
                <div class="card-body">
                    <form id="agreements_form">
                        <div class="{% if step > 4 %}d-none {% endif %}form_sheet">–°—Ç–∞–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ –≤–æ –≤—Ä–µ–º—è –≤—Å—Ç—Ä–µ—á–∏ (–ø–æ—Å–ª–µ —à–∞–≥–∞ 4)</div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        function save_form_aim(event) {
            $.ajax({
                url: "",
                headers: {
                    "X-CSRFToken": "{{ csrf_token }}",
                },
                dataType: 'json',
                data: $(event.target.form).serialize(),
                success: function(result) {
                    if (result['id']) {
                        try {
                            history.pushState(null, null, location.href.replace('/new', '/'+result['id']));
                            $('#members_form .form_sheet')[0].classList.add('d-none');
                        } catch(e) {}
                    }
                },
                error: function(jqxhr, a, b) {
                    console.log('error');
                    console.log(jqxhr.responseText);
                },
                method: "post"
            });
        }
        
        $('#aim_form').change(save_form_aim);
    </script>
{% endblock %}